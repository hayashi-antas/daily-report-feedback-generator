# プロンプト・システム仕様書：日報フィードバック生成（プロンプト外部管理 / Vertex AI 版）

## 0. この仕様書の位置づけ
この仕様書は、Googleスプレッドシート上で動作する「日報フィードバック生成ツール」のシステム構成およびプロンプト運用ルールを定義するものである。
本システムは、プロンプト（AIへの指示）をコード内に固定せず、**スプレッドシート上の管理シートから動的に読み込む方式**を採用する。

---

## 1. 実装コンテキスト
- **利用環境**：Google Workspace（企業プラン）上のスプレッドシート
- **データ構造**：
  1. **日記シート（シート名：日報）**：日報データを入力・出力するメインシート
  2. **プロンプトシート（シート名：prompts）**：プロンプトのテンプレートを管理するシート
- **セキュリティ要件**：業務情報を含むため、APIキーのコード埋め込みは不可。
- **認証・呼び出し方針**：
  - **Vertex AI (Gemini API in Vertex AI)** を利用する。
  - 認証には **GASのOAuthトークン** を使用し、GCPプロジェクトと連携する。
- **利用モデル・リージョン指定（Configuration）**：
  - **Region (Location)**: `us-central1` （最新モデル利用のため必須）
  - **Model ID**: `gemini-2.5-flash`

---

## 2. シート構造要件（Sheet Structure）

### A. プロンプト管理シート（シート名: `prompts`）
プロンプトのバリエーションを管理するデータベース。

| 列 | 項目名 | 説明 |
| :--- | :--- | :--- |
| **A列** | **モード名** | プルダウンに表示される名称（例：「標準」「関西弁」等） |
| **B列** | **プロンプトテンプレート** | AIへの指示文。後述のプレースホルダーを含む必要がある。 |
| **注意** | **1行目はヘッダー** | データは2行目から入力する。 |

### B. 日記シート（シート名: `日報`）
- **E1セル**：**モード選択用プルダウン**
  - 参照範囲：`prompts!A2:A`
  - ここで選択されたモード名に基づき、Geminiの人格が決定される。

---

## 3. 入力（Inputs）
実行時、以下の情報を組み合わせてGeminiへ送信する。

### 1. ユーザー選択（Control）
- **モード**：日記シートの **E1セル** の値
  - ※空欄の場合は、`prompts` シートの2行目（標準）をデフォルトとする。

### 2. 日報データ（Variable）
選択された行（3行目以降）のデータ。
- **日付**：B列
- **今日の内容**：C列
- **明日の予定**：D列

### 3. プロンプトテンプレート（Template）
`prompts` シートのA列を検索し、E1セルの値と一致する行のB列（文章）を取得する。

---

## 4. プロンプト構成ルール（Template Syntax）
`prompts` シートのB列に入力する文章には、以下の**プレースホルダー（置換タグ）**を必ず含めること。GAS実行時に実際のデータに置換される。

- `{{DATE}}` ： B列の日付に置換
- `{{CONTENT}}` ： C列の内容に置換
- `{{PLAN}}` ： D列の予定に置換

---

## 5. ロジック仕様（Logic）
- **通常実行**：
  - E1で選択されたモード名に対応するプロンプトテンプレートを取得し、データを埋め込んでGeminiへ送信する。
- **「ランダム」の扱い**：
  - `prompts` シート内に「ランダム」というモード名で定義されたプロンプト（AI自身にスタイルを選ばせる指示）が存在する場合は、それをそのまま使用する。
  - または、GAS側でランダム選択ロジックを実装し、既存のモードから抽選する方式をとってもよい。（本仕様では実装コード側に依存するが、基本はシート定義に従う）

---

## 6. 出力（Output）
- **出力先**：選択された行の **E列**
- **形式**：日本語プレーンテキスト
- **挙動**：既存の値があっても上書きする。

---

## 7. プロンプト定義セット（Reference Data）
以下の内容を `prompts` シートに登録して運用を開始する。

### モード1：標準
- **概要**: 穏やかで支援的な基本スタイル
- **テンプレート**: 「あなたは企業の従業員に寄り添う、穏やかで支援的なパートナーです...」

### モード2：意識高め
- **概要**: プロ意識の高いレビュー担当者（冷静・指摘重視）
- **テンプレート**: 「あなたはプロ意識の高いレビュー担当者です。感情的な叱責や人格評価は行わず...」

### モード3：関西弁
- **概要**: 大阪の世話焼きな先輩
- **テンプレート**: 「あんたは大阪の世話焼きな先輩や。親しみはあるけど、ちゃんと仕事の話はするタイプやと思ってな...」

### モード4：心理的安全性MAX版
- **概要**: 全肯定型のパートナー
- **テンプレート**: 「あなたは相手の努力や思考を見逃さない、全肯定型のパートナーです...」

### モード5：哲学的
- **概要**: 思考の記録としての伴走者（評価しない・内省重視）
- **テンプレート**: 「あなたは、日々の仕事を『思考の記録』として大切にする哲学的な伴走者です...」

### モード6：ランダム
- **概要**: AIが毎回スタイルをランダムに選択する
- **テンプレート**: 「以下のいずれかのスタイルをランダムに1つ選び、そのスタイルに一貫して従ってください...」
